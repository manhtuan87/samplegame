<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pop the Color! â€“ Game cho Tráº» Nhá»</title>
  <style>
    :root{
      --bg:#f6f7fb; --card:#ffffff; --txt:#222; --muted:#667185; --brand:#4f46e5; --ok:#16a34a; --warn:#eab308; --bad:#dc2626;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--txt)}
    .wrap{max-width:960px;margin:0 auto;padding:20px}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:12px}
    h1{font-size:clamp(22px,3vw,28px);margin:0;letter-spacing:.2px}
    .controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    select,button{border:1px solid #dfe3ea;background:#fff;padding:10px 14px;border-radius:12px;font-size:16px}
    button.primary{background:var(--brand);color:#fff;border-color:transparent}
    button.ghost{background:#fff}
    .card{background:var(--card);border:1px solid #e8ecf2;border-radius:16px;box-shadow:0 4px 16px rgba(0,0,0,.04)}
    .hud{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;padding:12px}
    .hud-item{background:#fafbff;border:1px solid #eef1f6;border-radius:12px;padding:12px;text-align:center}
    .hud-item .label{font-size:12px;color:var(--muted)}
    .hud-item .value{font-weight:700;font-size:20px}
    .arena{position:relative;height:60vh;min-height:420px;overflow:hidden;border-top:1px solid #eef1f6;border-radius:0 0 16px 16px}
    .prompt{padding:14px 16px;font-size:18px;border-bottom:1px solid #eef1f6}
    .balloon{position:absolute;display:flex;align-items:center;justify-content:center;width:96px;height:96px;border-radius:50%;color:#fff;font-weight:700;font-size:18px;user-select:none;cursor:pointer;box-shadow:0 6px 16px rgba(0,0,0,.12);transition:transform .08s ease}
    .balloon:active{transform:scale(.95)}
    .pop{animation:pop .25s ease forwards}
    @keyframes pop{to{transform:scale(1.25);opacity:0;filter:blur(2px)}}
    .footer{margin-top:14px;color:var(--muted);font-size:13px}
    .big{font-size:20px}
    .center{display:flex;justify-content:center;align-items:center;text-align:center}
    .hidden{display:none !important}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>ğŸˆ Pop the Color! <span class="big" id="title-sub">â€“ TrÃ² chÆ¡i cho bÃ©</span></h1>
      <div class="controls">
        <select id="lang">
          <option value="vi">Tiáº¿ng Viá»‡t</option>
          <option value="ja">æ—¥æœ¬èª</option>
        </select>
        <select id="difficulty">
          <option value="easy">Dá»…</option>
          <option value="normal" selected>Vá»«a</option>
          <option value="hard">KhÃ³</option>
        </select>
        <button class="ghost" id="howBtn">â“</button>
        <button class="primary" id="startBtn">â–¶ Báº¯t Ä‘áº§u</button>
      </div>
    </header>

    <div class="card">
      <div class="prompt" id="prompt">HÃ£y báº¥m vÃ o bÃ³ng mÃ u <b>Äá»</b>!</div>
      <div class="hud">
        <div class="hud-item"><div class="label" id="lblTarget">MÃ u cáº§n báº¥m</div><div class="value" id="targetColor">Äá»</div></div>
        <div class="hud-item"><div class="label" id="lblScore">Äiá»ƒm</div><div class="value" id="score">0</div></div>
        <div class="hud-item"><div class="label" id="lblTime">Thá»i gian</div><div class="value" id="time">60</div></div>
        <div class="hud-item"><div class="label" id="lblLevel">Má»©c</div><div class="value" id="level">1</div></div>
      </div>
      <div class="arena" id="arena"></div>
    </div>

    <div class="footer">ğŸ’¡ Máº¹o: DÃ nh cho tráº» tá»« 3â€“6 tuá»•i. NÃºt to, mÃ u sáº¯c rÃµ. KhÃ´ng cÃ³ quáº£ng cÃ¡o, khÃ´ng cáº§n Ä‘Äƒng nháº­p.</div>
  </div>

  <dialog id="how">
    <form method="dialog" style="border:none;padding:0">
      <div class="card" style="padding:18px;max-width:720px">
        <h3 id="howTitle" style="margin-top:0">CÃ¡ch chÆ¡i</h3>
        <p id="howBody">Báº¥m vÃ o bÃ³ng cÃ³ <b>mÃ u giá»‘ng</b> vá»›i mÃ u Ä‘Æ°á»£c yÃªu cáº§u. Má»—i láº§n Ä‘Ãºng +1 Ä‘iá»ƒm. Sai khÃ´ng trá»« Ä‘iá»ƒm, Ä‘á»«ng lo! Háº¿t thá»i gian sáº½ hiá»‡n káº¿t quáº£.</p>
        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:8px">
          <button>OK</button>
        </div>
      </div>
    </form>
  </dialog>

  <script>
  const i18n = {
    vi: {
      titleSub: 'â€“ TrÃ² chÆ¡i cho bÃ©',
      start: 'â–¶ Báº¯t Ä‘áº§u', how:'â“ HÆ°á»›ng dáº«n',
      labels:{target:'MÃ u cáº§n báº¥m', score:'Äiá»ƒm', time:'Thá»i gian', level:'Má»©c'},
      prompt: c=>`HÃ£y báº¥m vÃ o bÃ³ng mÃ u <b>${c}</b>!`,
      howTitle:'CÃ¡ch chÆ¡i',
      howBody:'Báº¥m vÃ o bÃ³ng cÃ³ <b>mÃ u giá»‘ng</b> vá»›i mÃ u Ä‘Æ°á»£c yÃªu cáº§u. Má»—i láº§n Ä‘Ãºng +1 Ä‘iá»ƒm. Sai khÃ´ng trá»« Ä‘iá»ƒm. Háº¿t thá»i gian sáº½ hiá»‡n káº¿t quáº£.',
      over: (sc)=>`Háº¿t giá»! Äiá»ƒm cá»§a bÃ©: ${sc}`
    },
    ja: {
      titleSub: 'â€“ å°ã•ãªãŠå­ã•ã¾å‘ã‘',
      start: 'â–¶ ã‚¹ã‚¿ãƒ¼ãƒˆ', how:'â“ ã‚ãã³ã‹ãŸ',
      labels:{target:'ã­ã‚‰ã†ã„ã‚', score:'ã‚¹ã‚³ã‚¢', time:'ã˜ã‹ã‚“', level:'ãƒ¬ãƒ™ãƒ«'},
      prompt: c=>`<b>${c}</b> ã®ãµã†ã›ã‚“ã‚’ã‚¿ãƒƒãƒ—ã—ã‚ˆã†ï¼`,
      howTitle:'ã‚ãã³ã‹ãŸ',
      howBody:'ã‚‚ã‚“ã ã„ã¨ãŠãªã˜ <b>ã„ã‚</b> ã® ãµã†ã›ã‚“ã‚’ã‚¿ãƒƒãƒ—ï¼ ã›ã„ã‹ã„ã§ +1ã€‚ã¾ã¡ãŒãˆã¦ã‚‚ ã¸ã‚‰ãªã„ã‚ˆã€‚ã˜ã‹ã‚“ãŒ ãã‚‹ã¨ ã‘ã£ã‹ãŒ ã§ã‚‹ã‚ˆã€‚',
      over: (sc)=>`ã˜ã‹ã‚“ãŠã—ã¾ã„ï¼ ã‚¹ã‚³ã‚¢ï¼š${sc}`
    }
  };

  const COLORS = [
    {key:'Red', vi:'Äá»', ja:'ã‚ã‹', hex:'#ef4444'},
    {key:'Blue', vi:'Xanh dÆ°Æ¡ng', ja:'ã‚ãŠ', hex:'#3b82f6'},
    {key:'Green', vi:'Xanh lÃ¡', ja:'ã¿ã©ã‚Š', hex:'#22c55e'},
    {key:'Yellow', vi:'VÃ ng', ja:'ãã„ã‚', hex:'#eab308'},
    {key:'Purple', vi:'TÃ­m', ja:'ã‚€ã‚‰ã•ã', hex:'#a855f7'},
    {key:'Orange', vi:'Cam', ja:'ã‚ªãƒ¬ãƒ³ã‚¸', hex:'#f97316'},
  ];

  const arena = document.getElementById('arena');
  const scoreEl = document.getElementById('score');
  const timeEl = document.getElementById('time');
  const levelEl = document.getElementById('level');
  const targetEl = document.getElementById('targetColor');
  const promptEl = document.getElementById('prompt');
  const startBtn = document.getElementById('startBtn');
  const howBtn = document.getElementById('howBtn');
  const howDlg = document.getElementById('how');
  const langSel = document.getElementById('lang');
  const diffSel = document.getElementById('difficulty');
  const titleSub = document.getElementById('title-sub');
  const lbls = ['lblTarget','lblScore','lblTime','lblLevel'].map(id=>document.getElementById(id));

  let state = {running:false, score:0, time:60, level:1, targetIdx:0, timers:[], lang:'vi'};

  function t(){return i18n[state.lang]}
  function colorName(c){return c[state.lang]}

  function setLang(l){
    state.lang = l;
    titleSub.textContent = i18n[l].titleSub;
    startBtn.textContent = i18n[l].start;
    howBtn.textContent = i18n[l].how;
    const L = i18n[l].labels;
    lbls[0].textContent = L.target; lbls[1].textContent = L.score; lbls[2].textContent = L.time; lbls[3].textContent = L.level;
    promptEl.innerHTML = i18n[l].prompt(colorName(COLORS[state.targetIdx]));
    document.getElementById('howTitle').textContent = i18n[l].howTitle;
    document.getElementById('howBody').innerHTML = i18n[l].howBody;
    targetEl.textContent = colorName(COLORS[state.targetIdx]);
  }

  langSel.addEventListener('change', e=>setLang(e.target.value));

  howBtn.addEventListener('click',()=>howDlg.showModal());

  function clearTimers(){state.timers.forEach(clearInterval); state.timers=[]}
  function rand(min,max){return Math.random()*(max-min)+min}

  function reset(){
    clearTimers();
    arena.innerHTML='';
    state.score=0; state.time=60; state.level=1; updateHUD();
  }

  function updateHUD(){
    scoreEl.textContent = state.score;
    timeEl.textContent = state.time;
    levelEl.textContent = state.level;
    targetEl.textContent = colorName(COLORS[state.targetIdx]);
    promptEl.innerHTML = t().prompt(colorName(COLORS[state.targetIdx]));
  }

  function chooseTarget(){
    state.targetIdx = Math.floor(Math.random()*COLORS.length);
    updateHUD();
  }

  function spawnBalloon(){
    const b = document.createElement('div');
    b.className='balloon';
    const color = COLORS[Math.floor(Math.random()*COLORS.length)];
    b.dataset.key = color.key;
    b.style.background = color.hex;
    b.style.left = rand(10, arena.clientWidth-110)+ 'px';
    b.style.top = rand(10, arena.clientHeight-110)+ 'px';
    b.title = colorName(color);
    b.textContent = '';

    b.addEventListener('click', ()=>{
      if(!state.running) return;
      b.classList.add('pop');
      if(color.key === COLORS[state.targetIdx].key){
        state.score += 1;
        if(state.score % 8 === 0){ state.level += 1; }
        if(state.score % 5 === 0){ chooseTarget(); }
      }
      setTimeout(()=> b.remove(), 220);
      updateHUD();
    });

    arena.appendChild(b);

    // auto fade after some time
    const life = 2500 - state.level*80; // shorter with level up
    setTimeout(()=>{
      if(b.isConnected){ b.classList.add('pop'); setTimeout(()=>b.remove(),220); }
    }, Math.max(900, life));
  }

  function gameLoop(){
    const spawnRate = {easy:900, normal:700, hard:520}[diffSel.value];
    state.timers.push(setInterval(spawnBalloon, spawnRate));
    state.timers.push(setInterval(()=>{
      if(!state.running) return;
      state.time -= 1; timeEl.textContent = state.time;
      if(state.time<=0){
        end();
      }
    }, 1000));
  }

  function start(){
    reset();
    chooseTarget();
    state.running = true;
    startBtn.disabled = true; diffSel.disabled = true; langSel.disabled = true;
    gameLoop();
  }

  function end(){
    state.running = false;
    clearTimers();
    startBtn.disabled = false; diffSel.disabled = false; langSel.disabled = false;
    alert(t().over(state.score));
  }

  document.addEventListener('visibilitychange', ()=>{ if(document.hidden && state.running){ end(); }});
  startBtn.addEventListener('click', start);

  // init
  setLang('vi');
  state.targetIdx = 0; updateHUD();
  </script>
</body>
</html>
